name: Pull Request on master branch

# only trigger on pull request closed events
on:
  pull_request:
    branches:
      - master

jobs:
  master_pr:
    name: 'PR on Master'
    runs-on: ubuntu-latest
    steps:
      - name: 'Checkout the code'
        uses: actions/checkout@v2

      - name: 'Display event informations'
        run: |
          echo "PR ${{ github.event.number }} has been opened on master branch"
          echo "The branch name is ${{ github.head_ref }}"
          echo "This PR is opened by ${{ github.event.pull_request.user.login }}"
          echo "The PR url is https://github.com/${{ github.repository }}/pull/${{ github.event.number }}"

      - name: 'Send Event informations to Discord Channel'
        if: ${{ success() }}
        uses: sarisia/actions-status-discord@v1
        with:
          webhook: ${{ secrets.DISCORD_WEBHOOK_URL }}
          title: 'A new PR is Opened on master âœ¨'
          description: |
            Branch `${{ github.head_ref }}`
            **Click [here](https://github.com/${{ github.repository }}/pull/${{ github.event.number }}) to review!**
          image: ${{ secrets.EMBED_IMAGE }}
          username: GitHub Actions
          nocontext: true

      - name: 'Test Another Github Action on Discord'
        if: ${{ success() }}
        env:
          DISCORD_WEBHOOK_URL: ${{ secrets.DISCORD_WEBHOOK_URL }}
        uses: Ilshidur/action-discord@master
        with:
          args: '@${{ secrets.DISCORD_ROLE }}'
